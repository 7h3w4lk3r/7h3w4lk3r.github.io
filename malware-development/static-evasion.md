# ðŸ”§ Static Evasion

## <mark style="color:red;">Quick Mapping</mark>

| Detection                                                                                                                                               | Evasion                                                                                                                                                                                                                                                                                                                                                                                        |
| ------------------------------------------------------------------------------------------------------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| <p><mark style="color:blue;"><strong>Signature-based Detection</strong></mark><br><mark style="color:blue;"><strong>String Analysis</strong></mark></p> | <p><mark style="color:red;"><strong>Payload / Shellcode Steganography</strong></mark></p><p><mark style="color:red;"><strong>Code Obfuscation</strong></mark><br><mark style="color:red;"><strong>Packing / Compression</strong></mark><br><mark style="color:red;"><strong>Encryption</strong></mark><br><mark style="color:red;"><strong>String Obfuscation / Encryption</strong></mark></p> |
| <mark style="color:blue;">**Metadata Analysis**</mark>                                                                                                  | <p><mark style="color:red;"><strong>Metadata Modification</strong></mark><br><mark style="color:red;"><strong>Binary Properties</strong></mark><br><mark style="color:red;"><strong>Certificate Spoofing</strong></mark></p>                                                                                                                                                                   |
| <mark style="color:blue;">**PE Header Analysis**</mark>                                                                                                 | <mark style="color:red;">**Keeping Original Headers**</mark>                                                                                                                                                                                                                                                                                                                                   |
| <mark style="color:blue;">**File Compression and Encryption Detection**</mark>                                                                          | <p><mark style="color:red;"><strong>Entropy Reduction</strong></mark><br><mark style="color:red;"><strong>Dead Code Insertion</strong></mark><br><mark style="color:red;"><strong>Code Cave (injection)</strong></mark></p>                                                                                                                                                                    |
| <mark style="color:blue;">**Dependency Analysis**</mark>                                                                                                | <mark style="color:red;">**Keeping Low Profile in API / syscall usage**</mark>                                                                                                                                                                                                                                                                                                                 |
| <mark style="color:blue;">**Control Flow Analysis**</mark>                                                                                              | <p><mark style="color:red;"><strong>Polymorphism</strong></mark><br><mark style="color:red;"><strong>Control Flow Obfuscation</strong></mark><br><mark style="color:red;"><strong>Compiler Options</strong></mark></p>                                                                                                                                                                         |
| <mark style="color:blue;">**Function Call Analysis**</mark>                                                                                             | <mark style="color:red;">**Function Call Obfuscation**</mark>                                                                                                                                                                                                                                                                                                                                  |
| <mark style="color:blue;">**Import/Export Table Examination**</mark>                                                                                    | <mark style="color:red;">**IAT / EAT Spoofing**</mark>                                                                                                                                                                                                                                                                                                                                         |
| <mark style="color:blue;">**Machine Learning**</mark>                                                                                                   | <mark style="color:red;">**Be Predictable and Act Normal :)**</mark>                                                                                                                                                                                                                                                                                                                           |

## <mark style="color:red;">Static Analysis Techniques</mark>

Static malware analysis is a method used to analyze malicious software (malware) without actually executing it. It involves examining the malware's code, structure, and behavior to understand its characteristics, potential impact, and methods of propagation. Static analysis is generally safer than dynamic analysis (executing the malware), as it doesn't run the risk of activating the malware's harmful functions. Antivirus (AV) and Endpoint Detection and Response (EDR) solutions use various techniques for static malware analysis to detect and mitigate threats.&#x20;

Here are some common techniques employed:

1. <mark style="color:green;">**Signature-based Detection:**</mark> This is the most basic form of detection. It involves comparing the digital signature (hash) of the malware's file against a database of known malicious signatures. If a match is found, the file is flagged as malware.
2. <mark style="color:green;">**String Analysis:**</mark> Malware often contains characteristic strings or keywords (mostly printable strings and characters) that can indicate its malicious intent. AV/EDR solutions scan the file for these strings, which might include network-related commands, suspicious file paths, or certain function names.
3. <mark style="color:green;">**Metadata Analysis:**</mark> File metadata, such as the compiler used, timestamps, and digital signatures, can provide insights into the malware's origin and authenticity. Metadata that doesn't match legitimate software can be an indicator of malicious activity.
4. <mark style="color:green;">**PE (Portable Executable) Header Analysis:**</mark> For Windows executables, the PE header contains information about the file's structure and properties. Analysis of this header can reveal anomalies, such as missing or tampered sections.
5. <mark style="color:green;">**File Compression and Encryption Detection:**</mark> Malware might be compressed or encrypted to avoid detection. Static analysis can identify patterns associated with common compression or encryption algorithms.
6. <mark style="color:green;">**Dependency Analysis:**</mark> Malware often relies on specific libraries, APIs, or resources. Identifying these dependencies can help in understanding the malware's capabilities and potential impact.
7. <mark style="color:green;">**Code Obfuscation and Packing Detection:**</mark> Malware authors often obfuscate or "pack" their code to evade detection. Static analysis attempts to reverse these techniques to reveal the actual code and behavior.
8. <mark style="color:green;">**File Entropy Analysis:**</mark> Entropy refers to the randomness or unpredictability of data within a file. In the context of malware analysis, this technique involves measuring the entropy of the bytes in a file to determine whether the file's contents appear to be highly structured (low entropy) or more random (high entropy).
9. <mark style="color:green;">**Control Flow Analysis:**</mark> Analyzing the flow of instructions within the malware's code can reveal loops, conditionals, and potential points of interest. This helps in understanding how the malware operates.
10. <mark style="color:green;">**Function Call Analysis:**</mark> Studying the functions called by the malware can provide insights into its behavior, such as whether it attempts to spread, establish persistence, or communicate with a command and control server.
11. <mark style="color:green;">**Import/Export Table Examination:**</mark> Looking at the functions imported and exported by the malware can indicate its capabilities and potential interaction with the operating system or other software.
12. <mark style="color:green;">**Behavioral Patterns:**</mark> Certain types of malware exhibit characteristic behaviors. Static analysis can help identify these patterns, such as the creation of autorun entries, modification of system files, or attempts to escalate privileges.
13. <mark style="color:green;">**Machine Learning and Heuristics:**</mark> Some AV/EDR solutions use machine learning models and heuristics to identify suspicious files based on patterns and anomalies found in the code.\


## <mark style="color:red;">Static Evasion Techniques</mark>

Malware authors often employ various evasion techniques to bypass static analysis techniques and evade detection by security tools. These techniques are designed to make the malicious code or file appear benign or undetectable to security solutions. Here are some common evasion techniques used to bypass static analysis:

1. <mark style="color:green;">**Code Obfuscation:**</mark> Malware authors obfuscate their code by applying transformations that alter the code's structure and appearance while preserving its functionality. This makes it harder for signature-based detection and string analysis to identify known patterns.
2. <mark style="color:green;">**Packing/Compression:**</mark> Malware can be packed or compressed using custom algorithms to make the file size smaller and obfuscate the original code. This makes it more difficult for static analysis to access and understand the actual malicious code.
3. <mark style="color:green;">**Encryption:**</mark> Malware might encrypt its payload using encryption algorithms. This results in a file with high entropy and appears as random data, making it challenging for static analysis to determine the file's true nature.
4. <mark style="color:green;">**Anti-Debugging Techniques:**</mark> Malware can include code that detects whether it's being analyzed in a debugger environment. If it detects analysis, it might behave differently or avoid revealing its malicious behavior.
5. <mark style="color:green;">**Dead Code Insertion:**</mark> Adding sections of seemingly unused or irrelevant code can confuse static analysis tools and distract analysts from identifying the actual malicious functions.
6. <mark style="color:green;">**Dynamic Code Generation:**</mark> Malware can generate its code dynamically during execution, making it harder to analyze statically. This technique requires dynamic analysis to observe the actual behavior.
7. <mark style="color:green;">**Conditional Execution:**</mark> Malware might use complex conditional statements to execute certain parts of its code only under specific circumstances, making it harder to predict its behavior statically.
8. <mark style="color:green;">**Polymorphism:**</mark> Polymorphic malware changes its appearance each time it infects a new system, altering its code while maintaining functionality. This makes it difficult to create static signatures for detection.
9. <mark style="color:green;">**Environment Detection:**</mark> Malware can detect if it's running in a virtual or sandbox environment and alter its behavior to avoid detection, making sandbox analysis less effective.
10. <mark style="color:green;">**Data Fragmentation:**</mark> The malware's code or data can be fragmented and spread across different sections of the file, making it harder for static analysis to reconstruct the full picture.
11. <mark style="color:green;">**String Encryption:**</mark> Malicious strings used in the code can be encrypted to avoid straightforward string-based detection. The decryption process happens during execution.
12. <mark style="color:green;">**Use of Legitimate Tools:**</mark> Malware might leverage legitimate tools and utilities present on the system to carry out malicious activities, which can make it blend in with normal system behavior.
13. <mark style="color:green;">**Time Delays:**</mark> Some malware employs time-based triggers that delay their malicious activities to avoid immediate detection by security solutions.
14. <mark style="color:green;">**File Manipulation:**</mark> Malware might alter file metadata, such as timestamps and digital signatures, to appear more legitimate and bypass metadata-based checks.
15. <mark style="color:green;">**Steganography:**</mark> Malware can be hidden within innocent-looking files, such as images or documents, using steganography techniques to evade static analysis.
16. <mark style="color:green;">**Multi-Stage Malware:**</mark> Malware can be designed to operate in multiple stages, with later stages being downloaded or generated dynamically. This makes it harder to analyze the entire malicious behavior statically.
